<!DOCTYPE html>
<html>
<head>
	<title>啦啦啦字幕</title>
	<meta charset="utf-8">
	<script src="./vue.js"></script>
	<style type="text/css">
		.img{
			height: 100%;
			position: relative;
			bottom: -25px;
		}
	</style>

	<style type="text/css">
		*{
			padding: 0;
			margin: 0;
			position: relative;
			/*border: 1px red solid;*/
		}
		.img-box{
			position: absolute;
			height: 300px;
			bottom: 0;
			overflow: hidden;
		}
		
		.container{
			width: 100%;
			height: 400px;
			border: 1px red solid;
			/*display: none;*/
		}
		.test-box{

		}
		.details{

		}
		.details input{
			width: 40px;
		}
		.details input[type='file']{
			width: 240px;
		}
	</style>
</head>
<body id='app'>
	<form class="details">
		<label for='upload'>上传图片：</label>
		<input type="file" id="imgUpload" name='upload' v-on:change='handleUpload'>

		<label for='qty'>数量：</label>
		<input type="text" id="num" name='qty' v-model='picQty'>
		<label for='img_height'>首图高度：</label>
		<input type="text" id="num" name='img_height' v-model='imgHeight'>
		<label for='cut_height'>底部剪裁：</label>
		<input type="text" id="num" name='cut_height' v-model='subCut'>
		<label for='height'>字幕高度:</label>
		<input type="text" id="num" name='height' v-model='subHeight'>
	</form>
	<p>  111</p>
	<div class="container">
		<div class="img-box" v-for='img in imgs'>
			<img v-bind:src="'./img/'+img.index+'.png'" alt="" class="img">
		</div>
	</div>
	<script type="text/javascript">
		var appVue=new Vue({
			el:'#app',
			data:{
				format:'png',
				imgs:[
				{index:3,format:'png'},
				{index:2,format:'png'},
				{index:1,format:'png'}
				],
				imgHeight:300,
				subCut:25,
				subHeight:35,
				picQty:4
			},
			methods:{
				setPst:function(){
					console.log('set pst')
					console.log('data',this._data)
					var imgBoxes=document.querySelectorAll('.img-box')
					,container=document.querySelector('.container')
					,imgs=document.querySelector('.img')
					,l=imgBoxes.length
					,subHeight=this._data.subHeight
					,subCut=this._data.subCut
					,imgHeight=this._data.imgHeight
					container.style.height=imgHeight+(l-1)*(subHeight)-subCut+'px'
					for(let i=0;i<l;i++){
						imgBoxes[i].style.bottom=subHeight*(i)+'px'
					}
				},
				handleUpload:function(){
					getFileUrl('imgUpload')
				}
			}
		})
		appVue.$watch('picQty',function(newVal,oldVal){
			var currentQty=this._data.imgs.length
			,self_=this
			console.log('currentQty',currentQty)
			if(currentQty<newVal){
				for(let i=currentQty+1;i<=newVal;i++){
					this._data.imgs.unshift({index:i,format:'png'})
				}
			}else{
				while(this._data.imgs.length!=newVal){
					this._data.imgs.shift()
				}
			}
			setTimeout(function() {
				self_.setPst()
			}, 10);
		})
		appVue.$watch('subHeight',function(newVal,oldVal){	
			this.setPst()
		})
		appVue.$watch('imgHeight',function(newVal,oldVal){	
			// this.setPst()
			var imgs=document.querySelector('.container')
			.querySelectorAll('img'),
			self_=this
			imgs.forEach(function(item){
				item.style.height=self_._data.imgHeight+'px'
			})

		})
		appVue.$watch('subCut',function(newVal,oldVal){	
			// this.setPst()
			var imgs=document.querySelector('.container')
			.querySelectorAll('img'),
			self_=this
			console.log('imgs',imgs)
			// for(let i=0;i<imgs.length;i++){
			// 	imgs[i]
			// }
			imgs.forEach(function(item){
				item.style.bottom=-self_._data.subCut+'px'
			})
		})
		console.log('appVue',appVue)
		appVue.setPst()

		function getFileUrl(sourceId) {
			var urls;
			// if (navigator.userAgent.indexOf("MSIE") >= 1) {  
			// 	urls = document.getElementById(sourceId).value;
			// } else 
			// 
			if (navigator.userAgent.indexOf("Firefox") > 0) {  
				urls = window.URL.createObjectURL(document.getElementById(sourceId).files);
			} else if (navigator.userAgent.indexOf("Chrome") > 0) {  
				urls = window.URL.createObjectURL(document.getElementById(sourceId).files)
			}else{
				urls = window.URL.createObjectURL(document.getElementById(sourceId).files)
			}
			console.log('urls',urls)
			return urls;
		}
	</script>
</body>
</html>